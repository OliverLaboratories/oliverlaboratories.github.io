<!DOCTYPE html>
<html> 
<head>
<meta charset=utf-8 />
<title>Protein Calculator</title>
<style type="text/css">
 body
    {
        width:80%;
        margin-left:auto;
        margin-right:auto;
    }

table {
  border-collapse: collapse;
  width: 100%;
}

th, td {
  text-align: left;
  padding: 8px;
}

tr:nth-child(even) {background-color: #f2f2f2;}

</style> 
</head>
<body>

	<h2> Carlos & Victoria's Protein Calculator </h2>

<img src="/assets/whale_weights.png" width="200px"></img>

<br><br><br>

<b> Which food has the most protein for the lowest cost and fewest calories? </b>


<p style="width: 500px;">
To compare producs just enter the information below <b>without units</b>. Then click 'Another one!' and enter the new item's information. A table at the bottom of the page will hold all the results.

<br><br>

This app runs fully on the client side so your data is never stored.

</p>

<br><br>

<form id="myForm">
Item name: <input type="text" id="itemName" /><br>
Protein per serving: <input type="text" id="protein" /><br>
Calories per serving: <input type="text" id="calories" /><br>
Serving size: <input type="text" id="serving" /><br>
Package size: <input type="text" id="itemSize" /><br>
Package cost: <input type="text" id="cost" /><br>
<input type="button" onClick="calculate()" value="Calculate!"/>
<input type="button" onClick="tableClear()" value="Another one!"/>
</form>


<table id="resultTable" cellspacing="35">
<tr>
<th scope="col">Item name</th>
<th scope="col">Calories per 1g of protein</th>
<th scope="col">Price per 1g of protein </th>
</tr>
</table>
<button id="downloadButton">Download as CSV</button>

</body>

<script>
function tableClear(){
	document.getElementById("myForm").reset();
}

function calculate(){
	itemName = document.getElementById("itemName").value;
	prot = document.getElementById("protein").value;
        cals = document.getElementById("calories").value;
        serving = document.getElementById("serving").value;
        itemSize = document.getElementById("itemSize").value;
        cost = document.getElementById("cost").value;

        protScore = (cals / prot).toFixed(3);
        priceScore = ((cost / (itemSize / serving)) / prot).toFixed(3);


  var table = document.getElementById("resultTable");
  var row = table.insertRow(-1);
  var cell1 = row.insertCell(0);
  var cell2 = row.insertCell(1);
  var cell3 = row.insertCell(2);
  cell1.innerHTML = itemName;
  cell2.innerHTML = protScore;
  cell3.innerHTML = priceScore;
}


// Function to convert a table to a CSV string
function tableToCSV(table) {
    const rows = table.querySelectorAll('tr');
    const csvData = [];

    for (const row of rows) {
        const cols = row.querySelectorAll('td, th');
        const rowData = [];

        for (const col of cols) {
            rowData.push(col.textContent.trim());
        }

        csvData.push(rowData.join(','));
    }

    return csvData.join('\n');
}

// Select the button and table
const downloadButton = document.getElementById("downloadButton");
const table = document.getElementById("resultTable");

// Add a click event listener to the button
downloadButton.addEventListener("click", () => {
    // Convert the table to a CSV string
    const csvContent = tableToCSV(table);

    // Create a Blob containing the CSV data
    const csvBlob = new Blob([csvContent], { type: "text/csv" });

    // Create a download link
    const downloadLink = document.createElement("a");
    downloadLink.href = URL.createObjectURL(csvBlob);
    downloadLink.download = "protein.csv"; // You can specify the file name here

    // Trigger the download
    downloadLink.click();

    // Clean up the URL object
    URL.revokeObjectURL(downloadLink.href);
});


</script>

</html>

